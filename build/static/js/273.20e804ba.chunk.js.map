{"version":3,"file":"static/js/273.20e804ba.chunk.js","mappings":"gPAWA,MAAMA,EAAeC,2CACfC,EAAoBD,mNAE1B,IAAIE,EAAY,KAChB,SAASC,IACP,GAAID,EAAW,OAAOA,EAMtB,IAEE,OADAA,GAAYE,EAAAA,EAAAA,IAAaL,EAAcE,GAChCC,CACT,CAAE,MAAOG,GAGP,OAFAC,QAAQC,KAAK,oCAAqCF,GAClDH,EAAY,KACL,IACT,CACF,CAEA,SAASM,EAAgBC,GACvB,OAAAC,EAAAA,EAAAA,GAAA,CACEC,UAAWF,EAAEE,WAAaF,EAAEG,UAAY,eACxCC,KAAMJ,EAAEI,OAASJ,EAAEK,UAAYL,EAAEK,UAAUC,MAAM,EAAE,IAAM,IACzDC,OAAQP,EAAEO,QAAUP,EAAEQ,SAAW,GACjCC,KAAMT,EAAES,MAAQ,GAChBC,WAAYV,EAAEU,YAAcV,EAAEK,YAAa,IAAIM,MAAOC,eAClDZ,EAAEa,GAAK,CAAEA,GAAIb,EAAEa,IAAO,CAAC,EAE/B,CAEOC,eAAeC,IACpB,IACE,MAAMC,QAAcC,EAAAA,EAAAA,KACpB,IAAKD,GAA0B,IAAjBA,EAAME,OAAc,MAAO,CAAEC,SAAU,EAAGC,QAAS,oBAEjE,MAAMC,EAAS3B,IACf,IAAK2B,EAAQ,MAAO,CAAEF,SAAU,EAAGG,MAAO,sBAE1C,MAAMC,EAAUP,EAAMQ,IAAIzB,IACpB,KAAE0B,EAAI,MAAEH,SAAgBD,EAAOK,KAAK,WAAWC,OAAOJ,GAC5D,GAAID,EAAO,MAAO,CAAEH,SAAU,EAAGG,SAEjC,UAAYM,EAAAA,EAAAA,GAAY,GAAK,CAAE,MAAOhC,GAAKC,QAAQC,KAAK,6CAA8CF,EAAI,CAE1G,MAAO,CAAEuB,SAAUU,MAAMC,QAAQL,GAAQA,EAAKP,OAAS,EAAGO,OAC5D,CAAE,MAAOM,GACP,MAAO,CAAEZ,SAAU,EAAGG,MAAOU,OAAOD,GACtC,CACF,CAEOjB,eAAemB,EAAqBC,GACzC,IACE,MAAMb,EAAS3B,IACf,IAAK2B,EAAQ,MAAO,CAAEC,MAAO,sBAC7B,MAAM,KAAEG,EAAI,MAAEH,SAAgBD,EAAOK,KAAK,WAAWC,OAAO,CAAC5B,EAAgBmC,KAC7E,OAAIZ,EAAc,CAAEA,SACb,CAAEG,OACX,CAAE,MAAO7B,GACP,MAAO,CAAE0B,MAAOU,OAAOpC,GACzB,CACF,CAOO,SAASuC,EAAkBC,GAChC,IACE,MAAMf,EAAS3B,IACf,IAAK2B,IAAWA,EAAOgB,QAGrB,OADAxC,QAAQC,KAAK,wEACN,CAAEwC,YAAaA,QAIxB,MAAMC,EAAKlB,EAAOgB,QAAQ,kBAAkBG,GAC1C,mBACA,CAAEC,MAAO,SAAUC,OAAQ,SAAUC,MAAO,WAC3CpB,IACC,IAAMa,GAAYA,EAASb,EAAQqB,IAAM,CAAE,MAAOhD,GAAKC,QAAQC,KAAK,oCAAqCF,EAAI,IASjH,OAJA2C,EAAGM,UAAU,CAACC,EAAQf,KAChBA,GAAKlC,QAAQC,KAAK,2BAA4BiC,KAG7C,CACLO,YAAaA,KACX,IAAMC,EAAGD,aAAe,CAAE,MAAM1C,GAAiB,GAGvD,CAAE,MAAOA,GAEP,OADAC,QAAQC,KAAK,2BAA4BF,GAClC,CAAE0C,YAAaA,OACxB,CACF,CAGA,SACE5C,eACAqB,yBACAkB,uBACAE,oB","sources":["sync.js"],"sourcesContent":["// src/sync.js\r\n// Supabase sync helpers with safe no-op behavior if env vars missing.\r\n// Exports:\r\n//   - initSupabase() => returns client or null\r\n//   - migrateLocalToSupabase() => attempts migrating local records (Promise)\r\n//   - pushRecordToSupabase(record) => insert one record (Promise)\r\n//   - subscribeRealtime(onRecord) => subscribe to realtime inserts (returns unsubscribe function)\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\nimport { loadRecords, saveRecords } from \"./db\";\r\n\r\nconst SUPABASE_URL = process.env.REACT_APP_SUPABASE_URL || \"\";\r\nconst SUPABASE_ANON_KEY = process.env.REACT_APP_SUPABASE_ANON_KEY || \"\";\r\n\r\nlet _supabase = null;\r\nfunction initSupabase() {\r\n  if (_supabase) return _supabase;\r\n  if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {\r\n    console.warn(\"initSupabase: supabase env not configured\");\r\n    _supabase = null;\r\n    return null;\r\n  }\r\n  try {\r\n    _supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\r\n    return _supabase;\r\n  } catch (e) {\r\n    console.warn(\"initSupabase: createClient failed\", e);\r\n    _supabase = null;\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction normalizeRecord(r) {\r\n  return {\r\n    device_id: r.device_id || r.deviceId || \"local-device\",\r\n    date: r.date || (r.createdAt ? r.createdAt.slice(0,10) : \"\"),\r\n    result: r.result || r.outcome || \"\",\r\n    hand: r.hand || \"\",\r\n    created_at: r.created_at || r.createdAt || new Date().toISOString(),\r\n    ...(r.id ? { id: r.id } : {})\r\n  };\r\n}\r\n\r\nexport async function migrateLocalToSupabase() {\r\n  try {\r\n    const local = await loadRecords();\r\n    if (!local || local.length === 0) return { inserted: 0, message: \"no local records\" };\r\n\r\n    const client = initSupabase();\r\n    if (!client) return { inserted: 0, error: \"no supabase config\" };\r\n\r\n    const payload = local.map(normalizeRecord);\r\n    const { data, error } = await client.from(\"records\").insert(payload);\r\n    if (error) return { inserted: 0, error };\r\n\r\n    try { await saveRecords([]); } catch (e) { console.warn(\"migrateLocalToSupabase: clear local failed\", e); }\r\n\r\n    return { inserted: Array.isArray(data) ? data.length : 0, data };\r\n  } catch (err) {\r\n    return { inserted: 0, error: String(err) };\r\n  }\r\n}\r\n\r\nexport async function pushRecordToSupabase(record) {\r\n  try {\r\n    const client = initSupabase();\r\n    if (!client) return { error: \"no supabase client\" };\r\n    const { data, error } = await client.from(\"records\").insert([normalizeRecord(record)]);\r\n    if (error) return { error };\r\n    return { data };\r\n  } catch (e) {\r\n    return { error: String(e) };\r\n  }\r\n}\r\n\r\n/**\r\n * subscribeRealtime(onRecord)\r\n * - onRecord(record) will be called when a new record arrives via realtime (insert).\r\n * - Returns an unsubscribe() function. If realtime not available or not configured, returns noop.\r\n */\r\nexport function subscribeRealtime(onRecord) {\r\n  try {\r\n    const client = initSupabase();\r\n    if (!client || !client.channel) {\r\n      // older/newer supabase client versions differ - try best-effort\r\n      console.warn(\"subscribeRealtime: supabase realtime not available or not configured\");\r\n      return { unsubscribe: () => {} };\r\n    }\r\n\r\n    // safe channel name\r\n    const ch = client.channel(\"public:records\").on(\r\n      \"postgres_changes\",\r\n      { event: \"INSERT\", schema: \"public\", table: \"records\" },\r\n      (payload) => {\r\n        try { onRecord && onRecord(payload.new); } catch (e) { console.warn(\"subscribeRealtime onRecord failed\", e); }\r\n      }\r\n    );\r\n\r\n    // subscribe\r\n    ch.subscribe((status, err) => {\r\n      if (err) console.warn(\"realtime subscribe error\", err);\r\n    });\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        try { ch.unsubscribe(); } catch(e) { /* ignore */ }\r\n      }\r\n    };\r\n  } catch (e) {\r\n    console.warn(\"subscribeRealtime failed\", e);\r\n    return { unsubscribe: () => {} };\r\n  }\r\n}\r\n\r\n// default export for backward compatibility\r\nexport default {\r\n  initSupabase,\r\n  migrateLocalToSupabase,\r\n  pushRecordToSupabase,\r\n  subscribeRealtime\r\n};\r\n"],"names":["SUPABASE_URL","process","SUPABASE_ANON_KEY","_supabase","initSupabase","createClient","e","console","warn","normalizeRecord","r","_objectSpread","device_id","deviceId","date","createdAt","slice","result","outcome","hand","created_at","Date","toISOString","id","async","migrateLocalToSupabase","local","loadRecords","length","inserted","message","client","error","payload","map","data","from","insert","saveRecords","Array","isArray","err","String","pushRecordToSupabase","record","subscribeRealtime","onRecord","channel","unsubscribe","ch","on","event","schema","table","new","subscribe","status"],"ignoreList":[],"sourceRoot":""}
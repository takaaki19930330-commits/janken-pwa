"use strict";(self.webpackChunkjanken_pwa=self.webpackChunkjanken_pwa||[]).push([[273],{273(e,r,a){a.r(r),a.d(r,{default:()=>f,migrateLocalToSupabase:()=>d,pushRecordToSupabase:()=>b,subscribeRealtime:()=>p});var t=a(555),n=a(726),c=a(668);const i="https://pncgiiafvoaqdxpiiaxf.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBuY2dpaWFmdm9hcWR4cGlpYXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0NzM2ODQsImV4cCI6MjA4MjA0OTY4NH0.rgokSRdD7jAt9BOeN0ryRbYlGoDrO_K2riT-TYaVn0E";let o=null;function u(){if(o)return o;try{return o=(0,n.UU)(i,s),o}catch(e){return console.warn("initSupabase: createClient failed",e),o=null,null}}function l(e){return(0,t.A)({device_id:e.device_id||e.deviceId||"local-device",date:e.date||(e.createdAt?e.createdAt.slice(0,10):""),result:e.result||e.outcome||"",hand:e.hand||"",created_at:e.created_at||e.createdAt||(new Date).toISOString()},e.id?{id:e.id}:{})}async function d(){try{const r=await(0,c.f)();if(!r||0===r.length)return{inserted:0,message:"no local records"};const a=u();if(!a)return{inserted:0,error:"no supabase config"};const t=r.map(l),{data:n,error:i}=await a.from("records").insert(t);if(i)return{inserted:0,error:i};try{await(0,c.W)([])}catch(e){console.warn("migrateLocalToSupabase: clear local failed",e)}return{inserted:Array.isArray(n)?n.length:0,data:n}}catch(r){return{inserted:0,error:String(r)}}}async function b(e){try{const r=u();if(!r)return{error:"no supabase client"};const{data:a,error:t}=await r.from("records").insert([l(e)]);return t?{error:t}:{data:a}}catch(r){return{error:String(r)}}}function p(e){try{const r=u();if(!r||!r.channel)return console.warn("subscribeRealtime: supabase realtime not available or not configured"),{unsubscribe:()=>{}};const a=r.channel("public:records").on("postgres_changes",{event:"INSERT",schema:"public",table:"records"},r=>{try{e&&e(r.new)}catch(a){console.warn("subscribeRealtime onRecord failed",a)}});return a.subscribe((e,r)=>{r&&console.warn("realtime subscribe error",r)}),{unsubscribe:()=>{try{a.unsubscribe()}catch(e){}}}}catch(r){return console.warn("subscribeRealtime failed",r),{unsubscribe:()=>{}}}}const f={initSupabase:u,migrateLocalToSupabase:d,pushRecordToSupabase:b,subscribeRealtime:p}}}]);
//# sourceMappingURL=273.20e804ba.chunk.js.map